import xarray as xr
import os
import pandas as pd

################ Paths ################

regionHome = "C:\\Users\\z3531278\\Documents\\01_FEWS-RegionHome-Aus"
xbWorkDir = os.path.join(regionHome, "Modules\\XBeach\\Narrabeen\\runs\\latest\\workDir")
ncOut = os.path.join(xbWorkDir, "xboutput.nc")
postProcessDir = os.path.join(xbWorkDir,"postProcess")

# Make directories if they don't exist
if not os.path.exists(postProcessDir):
        os.makedirs(postProcessDir)

# Load output
ds = xr.open_dataset(ncOut)
print(ds.point_xz)
print(ds.point_yz)
print(ds.point_zs)

# TODO: Export samples at time slices towards the beginning and end of the simulation (see visualizeMeshes.py)
# In order to make sure the gauges are in the right places
ds = ds.isel({"globaltime":80})

xx = ds["point_xz"][:,:].values.flatten()
yy = ds["point_yz"][:,:].values.flatten()
zz = ds["point_zs"][:,:].values.flatten()

# Export flattened array to csv
df = pd.DataFrame({"x":xx,
                    "y":yy,
                    "z":zz})

df.to_csv(os.path.join(postProcessDir, "test.csv"), index=False)

# Loop through each time slice and export as a series of shapefiles 